<html><head><meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
 <title>Animation merger</title>
 <style type="text/css"><!--
TABLE.toc {border:0px}
A:link,A:visited{text-decoration:none;color:#2A3B83}
A:hover{text-decoration:underline;color:#002040}
A:active{text-decoration:underline;color:#004060;background:#CCD8FF}
TD.toc   {font-size:80%; font-family:Tahoma; text-align:left}
H1       {font-size:250%; font-weight:bold} .level1 {text-align:center}
H2       {font-size:200%; font-weight:bold} .level2 {margin-left:1%}
H3       {font-size:160%; font-weight:bold} .level3 {margin-left:2%}
H4       {font-size:145%; font-weight:bold} .level4 {margin-left:3%}
H5       {font-size:130%; font-weight:bold} .level5 {margin-left:4%}
H6       {font-size:110%; font-weight:bold} .level5 {margin-left:5%}
BODY{background:white;color:black}
CODE{font-family:lucida console,courier new,courier;color:#105000}
PRE.smallerpre{font-family:lucida console,courier new,courier;font-size:80%;color:#500010;margin-left:30px}
SMALL    {font-size:70%}
.nonmail { visibility:hidden;position:absolute; top:0px;left:0px }
.ismail  { font-weight:normal }
--></style></head>
 <body>
  <h1>Animation merger</h1>
  <h2 class=level2> 0. Contents </h2>
  
  This is the documentation of animmerger-1.4.2.
<div class=toc><table cellspacing=0 cellpadding=0 class=toc><tr><td width="50%" valign=middle align=left nowrap class=toc>&nbsp;&nbsp;&nbsp;1. <a href="#h0">Purpose</a><br>&nbsp;&nbsp;&nbsp;2. <a href="#methods">Pixel methods</a><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2.1. <a href="#static">Static methods</a><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2.1.1. <a href="#average">AVERAGE</a><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2.1.2. <a href="#actionavg">ACTIONAVG</a><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2.1.3. <a href="#mostused">MOSTUSED</a><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2.1.4. <a href="#last">LAST</a><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2.1.5. <a href="#last">FIRST</a><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2.1.6. <a href="#firstnmost">FIRSTNMOST</a><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2.1.7. <a href="#lastnmost">LASTNMOST</a><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2.1.8. <a href="#leastused">LEASTUSED</a><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2.2. <a href="#animated">Animated methods</a><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2.2.1. <a href="#changelog">CHANGELOG</a><br></td>
<td width="50%" valign=middle align=left nowrap class=toc>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2.2.1.1. <a href="#motionblur">Motion blur</a><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2.2.2. <a href="#loopinglog">LOOPINGLOG</a><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2.2.3. <a href="#loopingavg">LOOPINGAVG</a><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2.2.3.1. <a href="#avgblur">Motion blur</a><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2.3. <a href="#methodsummary">Summary</a><br>&nbsp;&nbsp;&nbsp;3. <a href="#caveats">Caveats</a><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3.1. <a href="#caveat_parallax">Parallax motion</a><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3.2. <a href="#caveat_flash">Flashes, fog and other transparent layers</a><br>&nbsp;&nbsp;&nbsp;4. <a href="#usage">Usage</a><br>&nbsp;&nbsp;&nbsp;5. <a href="#h1">Copying</a><br>&nbsp;&nbsp;&nbsp;6. <a href="#h2">Requirements</a><br>&nbsp;&nbsp;&nbsp;7. <a href="#h3">See also</a><br>&nbsp;&nbsp;&nbsp;8. <a href="#download">Downloading</a><br></td>
</tr></table></div><H2 id="h0" class="level2"><a name="h0"></a>1. Purpose</H2><div class="level2" id="divh0">

Animmerger converts a 2D animation from local-frame-of-reference
into global-frame-of-reference. That is, for a movie that follows
an actor around (and the background scrolls to follow them), it
creates a movie that has a fixed background, and the camera moves
around in the scene.
<p>
It does this with a motion detection algorithm, a set of
different pixel methods, and a simulated infinite 2D canvas
&mdash; a 2D canvas that extends infinitely to all four directions
(well, as infinite as 32-bit integers can get&hellip;)

</div><H2 id="methods" class="level2"><a name="methods"></a>2. Pixel methods</H2><div class="level2" id="divmethods">

<table>
<tr><td valign=top>
<img src="http://bisqwit.iki.fi/jutut/kuvat/animmerger/original.gif"
     alt="Original animation">
</td><td valign=top>
As a sample, here is the original animation (712100 bytes).
<p>
The animation was created literally by taking a screenshot
from the NES emulator every frame.<br>
(I hacked the emulator
to automatically produce a screenshot after every frame.)
<p>
What follows below, is a list of the pixel methods supported
by animmerger,<br>
along with example images demonstrating what
that pixel method does.
<p>
The <code>-m0,8,256,16,020202,A64010,D09030,006E84,511800,FFFFFF</code><br>
parameter was given to animmerger to remove the HUD that is 256x16 wide<br>
and begins at 0,8. The hexadecimal numbers listed are these colors:
<table border=1>
 <tr>
  <td style="width:32px;height:32px;background:#020202;color:#FFF">020202</td>
  <td style="width:32px;height:32px;background:#A64010;color:#000">A64010</td>
  <td style="width:32px;height:32px;background:#D09030;color:#000">D09030</td>
  <td style="width:32px;height:32px;background:#006E84;color:#FFF">006E84</td>
  <td style="width:32px;height:32px;background:#511800;color:#FFF">511800</td>
  <td style="width:32px;height:32px;background:#FFFFFF;color:#000">FFFFFF</td>
 </tr>
</table>
This removes the text (white) as well as the blinking coin.
</td></tr></table><br>
<small>
The graphics material comes from Super Mario Bros.<br>
Mario, Super Mario Bros., and The Nintendo Entertainment System (NES)
are registered trademarks of Nintendo of America Inc.
But you knew that, right?</small>

</div><H3 id="static" class="level3"><a name="static"></a>2.1. Static methods</H3><div class="level3" id="divstatic">

</div><H4 id="average" class="level4"><a name="average"></a>2.1.1. AVERAGE</H4><div class="level4" id="divaverage">

The "average" method produces a "motion blur" effect of the entire
input, reducing it into a single frame.
<p>
<img src="http://bisqwit.iki.fi/jutut/kuvat/animmerger/method-a.png"
     alt="Average">
<p>
You can see a faint trace of all animated actors that appeared in
the animation. Mario moved very fast so his trace is quite difficult
to spot.
<p>
Produced with commandline:<br>
<code># animmerger -pa snaps/*.png -m0,8,256,16,020202,A64010,D09030,006E84,511800,FFFFFF<br>
# mv tile-0000.png demo/method-a.png</code>
<p>
An alternative implementation of "average" is also provided: "tinyaverage" (option -A).
It requires less memory to store, but is less accurate to calculate.
<p>
If you want the color averages to be calculated through the YUV colorspace
rather than the RGB colorspace, add the --yuv option (not supported by tinyaverage).

</div><H4 id="actionavg" class="level4"><a name="actionavg"></a>2.1.2. ACTIONAVG</H4><div class="level4" id="divactionavg">

The "actionavg" method attempts to fix the faintness problem with
"average" method by keeping track separately of the background
(using the "mostused" method) and adding it only once to the
average of moving actors.
<p>
<img src="http://bisqwit.iki.fi/jutut/kuvat/animmerger/method-t.png"
     alt="Action average">
<p>
Produced with commandline:<br>
<code># animmerger -pt snaps/*.png -m0,8,256,16,020202,A64010,D09030,006E84,511800,FFFFFF<br>
# mv tile-0000.png demo/method-t.png</code>
<p>
If you want the color averages to be calculated through the YUV colorspace
rather than the RGB colorspace, add the --yuv option.

</div><H4 id="mostused" class="level4"><a name="mostused"></a>2.1.3. MOSTUSED</H4><div class="level4" id="divmostused">

The "most used" method produces what might be the background
image for the entire animation.
<p>
<img src="http://bisqwit.iki.fi/jutut/kuvat/animmerger/method-m.png"
     alt="Most used">
<p>
Note: If there is an actor that sits in a certain location
for a long time, it is also recorded.<br>
In this example, there were none though.<br>
This mode does not thus remove all actors, but it does remove
anything that wanders around.
<p>
Produced with commandline:<br>
<code># animmerger -pm snaps/*.png -m0,8,256,16,020202,A64010,D09030,006E84,511800,FFFFFF<br>
# mv tile-0000.png demo/method-m.png</code>

</div><H4 id="last" class="level4"><a name="last"></a>2.1.4. LAST</H4><div class="level4" id="divlast">

The "last" method is a simpler implementation of the "most used"
method, simply recording the last pixel value in any location.
<p>
<img src="http://bisqwit.iki.fi/jutut/kuvat/animmerger/method-l.png"
     alt="Last">
<p>
Produced with commandline:<br>
<code># animmerger -pl snaps/*.png -m0,8,256,16,020202,A64010,D09030,006E84,511800,FFFFFF<br>
# mv tile-0000.png demo/method-l.png</code>

</div><H4 id="last" class="level4"><a name="last"></a>2.1.5. FIRST</H4><div class="level4" id="divlast">

The "first" method is analogous to "last".
It shows whatever first appeared in a particular pixel location.
<p>
<img src="http://bisqwit.iki.fi/jutut/kuvat/animmerger/method-f.png"
     alt="First">
<p>
The turtles are distorted, because they moved while the screen scrolled.<br>
It is the same effect as if you move the paper in a desktop scanner during the scanning.
<p>
Produced with commandline:<br>
<code># animmerger -pf snaps/*.png -m0,8,256,16,020202,A64010,D09030,006E84,511800,FFFFFF<br>
# mv tile-0000.png demo/method-f.png</code>

</div><H4 id="firstnmost" class="level4"><a name="firstnmost"></a>2.1.6. FIRSTNMOST</H4><div class="level4" id="divfirstnmost">

The "firstnmost" method is analogous to "first" and "mostused";
it chooses the most common pixel of first N pixel values.
Set N with the --firstlast (-f) option.<br>
If N is 0, instead gets last uncommon pixel.<br>
If N is negative, using least common values rather than most common.
<p>
Most common of first 4:<br>
<img src="http://bisqwit.iki.fi/jutut/kuvat/animmerger/method-Ff4.png"
     alt="Most common of first 4">
<p>
Most common of first 10:<br>
<img src="http://bisqwit.iki.fi/jutut/kuvat/animmerger/method-Ff10.png"
     alt="Most common of first 10">
<p>
Most common of first 16:<br>
<img src="http://bisqwit.iki.fi/jutut/kuvat/animmerger/method-Ff16.png"
     alt="Most common of first 16">
<p>
First uncommon:<br>
<img src="http://bisqwit.iki.fi/jutut/kuvat/animmerger/method-Ff0.png"
     alt="First uncommon">
<p>
Least common of first 10:<br>
<img src="http://bisqwit.iki.fi/jutut/kuvat/animmerger/method-Ff-10.png"
     alt="Least common of first 10">
<p>
Produced with commandline:<br>
<code># for f in 4 10 -10 16 0; do <br>
# &nbsp; animmerger -pF -f$f snaps/*.png -m0,8,256,16,020202,A64010,D09030,006E84,511800,FFFFFF<br>
# &nbsp; mv tile-0000.png demo/method-Ff$f.png<br>
# done</code>

</div><H4 id="lastnmost" class="level4"><a name="lastnmost"></a>2.1.7. LASTNMOST</H4><div class="level4" id="divlastnmost">

The "lastnmost" method is analogous to "last" and "mostused";
it chooses the most common pixel of last N pixel values.
Set N with the --firstlast (-f) option.<br>
If N is 0, instead gets last uncommon pixel.<br>
If N is negative, using least common values rather than most common.
<p>
Most common of last 10:<br>
<img src="http://bisqwit.iki.fi/jutut/kuvat/animmerger/method-Lf10.png"
     alt="Most common of last 10">
<p>
Last uncommon:<br>
<img src="http://bisqwit.iki.fi/jutut/kuvat/animmerger/method-Lf0.png"
     alt="Last uncommon">
<p>
Least common of last 10:<br>
<img src="http://bisqwit.iki.fi/jutut/kuvat/animmerger/method-Lf-10.png"
     alt="Least common of last 10">
<p>
Produced with commandline:<br>
<code># for f in 4 10 -10 16 0; do <br>
# &nbsp; animmerger -pL -f$f snaps/*.png -m0,8,256,16,020202,A64010,D09030,006E84,511800,FFFFFF<br>
# &nbsp; mv tile-0000.png demo/method-Lf$f.png<br>
# done</code>

</div><H4 id="leastused" class="level4"><a name="leastused"></a>2.1.8. LEASTUSED</H4><div class="level4" id="divleastused">

The "least used" method is analogous to "most used".<br>
It can be used to find graphical artifacts and teleporting actors,
but for the most part, the output is not very useful.
<p>
<img src="http://bisqwit.iki.fi/jutut/kuvat/animmerger/method-e.png"
     alt="Least used">
<p>
Produced with commandline:<br>
<code># animmerger -pe snaps/*.png -m0,8,256,16,020202,A64010,D09030,006E84,511800,FFFFFF<br>
# mv tile-0000.png demo/method-e.png</code>

</div><H3 id="animated" class="level3"><a name="animated"></a>2.2. Animated methods</H3><div class="level3" id="divanimated">

</div><H4 id="changelog" class="level4"><a name="changelog"></a>2.2.1. CHANGELOG</H4><div class="level4" id="divchangelog">

The "changelog" method records the entire animation (121995 bytes in this example).<br>
It takes considerably less disk space (and is faster to load) than the original animation, because now the background does not scroll.
<p>
<img src="http://bisqwit.iki.fi/jutut/kuvat/animmerger/method-c.gif"
     alt="Changelog">
<p>
You see some artifacts in the turtle and in Mario when they appear
near the top of the screen. This is because they were behind the
HUD (the text "WORLD 8-2" for instance), which was removed.<br>
In the case of the turtle, the turtle's white pixels were also
removed, because the HUD removal was based on color as well
as coordinates.<br>
Horizontal disappearance of the actors is because of the viewport
scrolling past them. They do not exist outside those parameters
in the original animation either.
<p>
Here is how the animation looks like, if the HUD is not removed. (246643 bytes)
<p>
<img src="http://bisqwit.iki.fi/jutut/kuvat/animmerger/method-tc.gif"
     alt="Changelog, with HUD intact">
<p>
Exteriors, i.e. content outside the "current" viewport of the animation
are colored as in the "most used" pixel method.<br>
This is evident in the trails left by the HUD as it scrolls by at different speeds.
<p>
Produced with commandline:<br>
<code>
# rm tile-*.png tile-*.gif<br>
# animmerger --gif -pc snaps/*.png -m0,8,256,16,020202,A64010,D09030,006E84,511800,FFFFFF<br>
# <a href="http://www.lcdf.org/gifsicle/">gifsicle</a> -O2 -o demo/method-c.gif -l0 -d3 tile-*.gif</code><br>
The version with HUD intact was created with the same commandline,
except with the -m option removed.

</div><H5 id="motionblur" class="level5"><a name="motionblur"></a>2.2.1.1. Motion blur</H5><div class="level5" id="divmotionblur">

The changelog method also supports motion blur. Use the --motionblur (-B) option to set it.
Value 0 disables motion blur (default: 0).
<p>
Blur length 1:<br>
<img src="http://bisqwit.iki.fi/jutut/kuvat/animmerger/method-cB1.gif"
     alt="Changelog, blur 1">
<p>
Blur length 4:<br>
<img src="http://bisqwit.iki.fi/jutut/kuvat/animmerger/method-cB4.gif"
     alt="Changelog, blur 4">
<p>
Blur length 20:<br>
<img src="http://bisqwit.iki.fi/jutut/kuvat/animmerger/method-cB20.gif"
     alt="Changelog, blur 1">
<p>
Produced with commandline:<br>
<code>
# for b in 1 4 20;do <br>
# &nbsp; rm tile-*.png tile-*.gif<br>
# &nbsp; animmerger --gif -B$b -pc snaps/*.png -m0,8,256,16,020202,A64010,D09030,006E84,511800,FFFFFF<br>
# &nbsp; gifsicle -O2 -o demo/method-cB"$b".gif -l0 -d3 tile-*.gif<br>
# done</code>

</div><H4 id="loopinglog" class="level4"><a name="loopinglog"></a>2.2.2. LOOPINGLOG</H4><div class="level4" id="divloopinglog">

The "loopinglog" method records the entire animation,
but reuses existing frames. Use the <code>-l</code> option
to set the loop length in frames.<br>
The smaller value you use, the shorter the animation
is in the number of frames, but the more pronounced
is the "lemmings" effect.
<p>
30 frames (94895 bytes):<br>
<img src="http://bisqwit.iki.fi/jutut/kuvat/animmerger/method-sl30.gif"
     alt="Loop, 30 frames">
<p>
10 frames (66738 bytes):<br>
<img src="http://bisqwit.iki.fi/jutut/kuvat/animmerger/method-sl10.gif"
     alt="Loop, 10 frames">
<p>
4 frames (40372 bytes):<br>
<img src="http://bisqwit.iki.fi/jutut/kuvat/animmerger/method-sl4.gif"
     alt="Loop, 4 frames">
<p>
Produced with commandline:<br>
<code>
# for l in 4 10 30; do <br>
# &nbsp; rm tile-*.png tile-*.gif<br>
# &nbsp; animmerger --gif -l$l -po snaps/*.png -m0,8,256,16,020202,A64010,D09030,006E84,511800,FFFFFF<br>
# &nbsp; gifsicle -O2 -o demo/method-sl"$l".gif -l0 -d3 tile-*.gif<br>
# done</code>
 <p>
It is also called "loopinglast" mode (option -s)
to differentiate from "loopingavg".
 <p>
The loopinglog method also supports motion blur.
Use the --motionblur (-B) option to set it.
Value 0 disables motion blur (default: 0).

</div><H4 id="loopingavg" class="level4"><a name="loopingavg"></a>2.2.3. LOOPINGAVG</H4><div class="level4" id="divloopingavg">

The "loopingavg" method combines the "loopinglog" and "actionavg" methods.
Use the <code>-l</code> option to set the loop length in frames.<br>
The most important difference to "loopinglog" is that overlapping action
is averaged rather than explicitly choosing one of the acting pixels.<br>
It looks slightly better, but may require GIF palette reduction.<br>
In comparison, "loopinglog" only uses pixel colors present
in the original images.
<p>
30 frames (file size depends on selected palette size):<br>
<img src="http://bisqwit.iki.fi/jutut/kuvat/animmerger/method-vl30.gif"
     alt="Loop, 30 frames">
<p>
10 frames:<br>
<img src="http://bisqwit.iki.fi/jutut/kuvat/animmerger/method-vl10.gif"
     alt="Loop, 10 frames">
<p>
4 frames:<br>
<img src="http://bisqwit.iki.fi/jutut/kuvat/animmerger/method-vl4.gif"
     alt="Loop, 4 frames">
<p>
Produced with commandline:<br>
<code>
# for l in 4 10 30 80; do <br>
# &nbsp; rm tile-*.png tile-*.gif<br>
# &nbsp; animmerger --gif -l$l -pv snaps/*.png -m0,8,256,16,020202,A64010,D09030,006E84,511800,FFFFFF<br>
# &nbsp; gifsicle -O2 -k128 -o demo/method-ov"$l".gif -l0 -d3 tile-*.gif<br>
# done</code>
<p>
If you want the color averages to be calculated through the YUV colorspace
rather than the RGB colorspace, add the --yuv option.<br>
In most cases, the difference is neglible though.

</div><H5 id="avgblur" class="level5"><a name="avgblur"></a>2.2.3.1. Motion blur</H5><div class="level5" id="divavgblur">

The loopingavg method also supports motion blur.
Use the --motionblur (-B) option to set it.
Value 0 disables motion blur (default: 0).
<p>
Loop length 30 frames, blur length 20:<br>
<img src="http://bisqwit.iki.fi/jutut/kuvat/animmerger/method-vl30B20.gif"
     alt="Loop-Avg 30, blur 8">
<p>
Loop length 30 frames, blur length 20, with YUV calculations:<br>
<img src="http://bisqwit.iki.fi/jutut/kuvat/animmerger/method-vl30yB20.gif"
     alt="Loop-Avg 30 through YUV, blur 8">
<p>
Loop length 10 frames, blur length 4:<br>
<img src="http://bisqwit.iki.fi/jutut/kuvat/animmerger/method-vl10B4.gif"
     alt="Loop-Avg 10, blur 4">
<p>
Produced with commandline:<br>
<code>
# for b in 4 8 20;do <br>
# &nbsp; for l in 10 30;do <br>
# &nbsp; &nbsp; rm tile-*.png tile-*.gif<br>
# &nbsp; &nbsp; animmerger --gif -B$b -l$l -pl snaps/*.png -m0,8,256,16,020202,A64010,D09030,006E84,511800,FFFFFF<br>
# &nbsp; &nbsp; gifsicle -O2 -o demo/method-vl"$l"B"$b".gif -l0 -d3 tile-*.gif<br>
# &nbsp; done<br>
# done</code>

</div><H3 id="methodsummary" class="level3"><a name="methodsummary"></a>2.3. Summary</H3><div class="level3" id="divmethodsummary">

<table border=1 style="text-align:left">
 <tr valign=bottom>
  <th>Method name</th>
  <th>Static or<br>animated</th>
  <th>Composes<br>new colors</th>
  <th>Obeys YUV<br>option</th>
  <th>Memory size per pixel*</th>
  <th>Primary<br>use</th>
 </tr><tr><th>First</th>                  <td>Static          </td>   <td>No</td>     <td>No       </td><td>4</td>                                          <td>Maps</td>
 </tr><tr><th>Last</th>                   <td>Static          </td>   <td>No</td>     <td>No       </td><td>4</td>                                          <td></td>
 </tr><tr><th>FirstNMost</th>             <td>Static          </td>   <td>No</td>     <td>No       </td><td>As ChangeLog</td>                               <td></td>
 </tr><tr><th>&middot; FirstUncommon</th> <td>Static          </td>   <td>No</td>     <td>No       </td><td>As ChangeLog</td>                               <td></td>
 </tr><tr><th>&middot; FirstNLeast</th>   <td>Static          </td>   <td>No</td>     <td>No       </td><td>As ChangeLog</td>                               <td></td>
 </tr><tr><th>LastNMost</th>              <td>Static          </td>   <td>No</td>     <td>No       </td><td>As ChangeLog</td>                               <td></td>
 </tr><tr><th>&middot; LastUncommon</th>  <td>Static          </td>   <td>No</td>     <td>No       </td><td>As ChangeLog</td>                               <td></td>
 </tr><tr><th>&middot; LastNLeast</th>    <td>Static          </td>   <td>No</td>     <td>No       </td><td>As ChangeLog</td>                               <td></td>
 </tr><tr><th>MostUsed</th>               <td>Static          </td>   <td>No</td>     <td>No       </td><td>12&hellip;16 + 6*number of unique colors</td>   <td>Maps</td>
 </tr><tr><th>LeastUsed</th>              <td>Static          </td>   <td>No</td>     <td>No       </td><td>As MostUsed</td>                                <td></td>
 </tr><tr><th>Average</th>                <td>Static          </td>   <td>Yes</td>    <td>Yes      </td><td>16</td>                                         <td></td>
 </tr><tr><th>Tinyaverage</th>            <td>Static          </td>   <td>Yes</td>    <td>No       </td><td>8</td>                                          <td></td>
 </tr><tr><th>ActionAvg</th>              <td>Static          </td>   <td>Yes</td>    <td>Yes      </td><td>As MostUsed</td>                                <td></td>
 </tr><tr><th>ChangeLog</th>              <td>Animated (movie)</td> <td>If blur</td><td>For blur </td><td>12&hellip;16 + 8*number of content changes</td> <td>Animations</td>
 </tr><tr><th>LoopingLog</th>             <td>Animated (loop) </td> <td>If blur</td><td>For blur </td><td>As ChangeLog</td>                               <td></td>
 </tr><tr><th>LoopingAvg</th>             <td>Animated (loop) </td> <td>Yes</td>    <td>Yes      </td><td>As ChangeLog</td>                               <td>Fun</td>
 </tr>
</table>
 <p>
*) These numbers are estimates. Actual memory size per pixel depends
on the exact selection of pixel methods requested and the memory
allocation overhead. Animmerger strives
to always select the smallest combination of pixel methods
(memoryconsumptionwise) that can implement all the requested methods.

</div><H2 id="caveats" class="level2"><a name="caveats"></a>3. Caveats</H2><div class="level2" id="divcaveats">

</div><H3 id="caveat_parallax" class="level3"><a name="caveat_parallax"></a>3.1. Parallax motion</H3><div class="level3" id="divcaveat_parallax">

Parallax motion is bad. When animating video game content, please ensure that
all background layers are synchronized. Note that this will likely require you
to hack the emulator that is used to produce the video frames.
<p>
If different background layers are moving at different speeds with respect
to the camera, animmerger will sync into one of them (probably the one that
occupies the largest screen area), and the rest will appear to be moving with
respect to the chosen background.
 <p>
Example:<br>
<table border=1>
 <tr>
  <td colspan=2>
This scene is from Super Mario World. The HUD layer is disabled,
but otherwise it is an intact animation. The palette was reduced
and fps halved to make the file slightly smaller for web distribution.
  </td>
 </tr>
 <tr valign=top>
  <td width="480">
<img src="http://bisqwit.iki.fi/jutut/kuvat/animmerger/pano5-cl.gif"
     alt="Super Mario World with parallax motion">
  </td>
  <td width="480">
<img src="http://bisqwit.iki.fi/jutut/kuvat/animmerger/pano5-fl.gif"
     alt="Super Mario World with parallax fix"><br>
  </td>
 </tr>
 <tr valign=top>
  <td>
You can easily see the problem with parallax motion: Sometimes
the image alignment syncs to the platforms, sometimes it syncs
to the stalactite background. When it syncs to the platforms, the
other background can be seeing moving as a distinct layer.
</td>
  <td>
In this version, the background layers move in unison with respect
to the camera. As such, the image alignment is perfect.<br>
This was achieved with the following patch to snes9x:
<pre style="font-size:84%;height:6em;overflow:auto;border:1px solid #444;padding:1px"
>--- ppu.cpp~    2010-08-17 23:46:11.022843689 +0300
+++ ppu.cpp     2010-08-17 22:34:52.000000000 +0300
@@ -416,2 +416,3 @@
                        PPU.BG[0].HOffset = (Byte<<8) | PPU.BGnxOFSbyte;
+                       PPU.BG[1].HOffset = (Byte<<8) | PPU.BGnxOFSbyte;
                        PPU.BGnxOFSbyte = Byte;
@@ -423,2 +424,3 @@
                        PPU.BG[0].VOffset = (Byte<<8) | PPU.BGnxOFSbyte;
+                       PPU.BG[1].VOffset = (Byte<<8) | PPU.BGnxOFSbyte;
                        PPU.BGnxOFSbyte = Byte;
@@ -429,3 +431,3 @@
                  case 0x210F:
-                       PPU.BG[1].HOffset = (Byte<<8) | PPU.BGnxOFSbyte;
+                       //PPU.BG[1].HOffset = (Byte<<8) | PPU.BGnxOFSbyte;
                        PPU.BGnxOFSbyte = Byte;
@@ -436,3 +438,3 @@
                  case 0x2110:
-                       PPU.BG[1].VOffset = (Byte<<8) | PPU.BGnxOFSbyte;
+                       //PPU.BG[1].VOffset = (Byte<<8) | PPU.BGnxOFSbyte;
                        PPU.BGnxOFSbyte = Byte;</pre>
</td></tr>
</table>

The commands used to produce these animations were:<br>
<code># rm tile-*.gif;  animmerger -v -r12x12 -bl -pc -a -4,-3,6,9 pano5/*.png<br>
# rm tile-???[13579].gif   # Delete 50% of frames to reduce fps in half<br>
# gifsicle -O2 -o demo/pano5-cl.gif --crop 8,8+480x400 --use-colormap smwpalette.gif -l0 -d6 tile-????.gif<br>
# rm tile-*.gif; animmerger -v -r12x12 -bl -pc -a -4,-3,6,9 pano5b/*.png<br>
# rm tile-???[13579].gif   # Delete 50% of frames to reduce fps in half<br>
# gifsicle -O2 -o demo/pano5-fl.gif --crop 8,8+480x400 --use-colormap smwpalette.gif -l0 -d6 tile-????.gif
</code>
<p>
The palette file was customized by hand, by taking a representative
snapshot of the movie, and then progressively merging near-identical
entries in the colormap in GIMP manually until only the minimal
set of unique colors/tones remain.

</div><H3 id="caveat_flash" class="level3"><a name="caveat_flash"></a>3.2. Flashes, fog and other transparent layers</H3><div class="level3" id="divcaveat_flash">

The image aligning engine is confused by anything that
globally changes the screen brightness.  This includes
any pain-red-tinting, white-explosion flashes, fog clouds,
etc. Please try to avoid them.
 <p>
Example:<br>
<i>TODO: Add successful Super Metroid animation</i>
<p>
<i>TODO: Add example of how image alignment suffers
when using the power bomb in Super Metroid</i>

</div><H2 id="usage" class="level2"><a name="usage"></a>4. Usage</H2><div class="level2" id="divusage">

<pre class=smallerpre>animmerger v1.4.1 - Copyright (C) 2010 Joel Yliluoma (http://iki.fi/bisqwit/)

Usage: animmerger [&lt;options&gt;] &lt;imagefile&gt; [&lt;...&gt;]

Merges animation frames together with motion shifting.

 --help, -h             This help
 --mask, -m &lt;defs&gt;      Define a mask, see instructions below
 --method, -p &lt;mode&gt;    Select pixel type, see below
 --bgmethod, -b &lt;mode&gt;  Select pixel type for alignment tests
 --looplength, -l &lt;int&gt; Set loop length for the LOOPINGxx modes
 --motionblur, -B &lt;int&gt; Set motion blur length for animated modes
 --firstlast, -f &lt;int&gt;  Set threshold for xxNMOST modes
 --version, -V          Displays version information
 --yuv, -y              Sets YUV mode for average-color calculations
                        Affects AVERAGE, ACTIONAVG and LOOPINGAVG.
 --refscale, -r &lt;x&gt;,&lt;y&gt;
     Change the grid size that controls
     how many samples are taken from the background image
     for comparing with the input image, for image alignment.
     Smaller grid = more accurate but slower aligning.
     Default: -r32,32
     Set to e.g. -r8,8 if you experience misalignment problems.
 --mvrange, -a &lt;xmin&gt;,&lt;ymin&gt;,&lt;xmax&gt;,&lt;ymax&gt;
     Change the limits of motion vectors.
     Default: -9999,-9999,9999,9999
     Example: --mvrange -4,0,4,0 specifies that the screen may
     only scroll horizontally and by 4 pixels at most per frame.
 --gif, -g              Save GIF frames instead of PNG frames
 --verbose, -v          Increase verbosity

animmerger will always output PNG files into the current
working directory, with the filename pattern tile-####.png
where #### is a sequential number beginning from 0000.

AVAILABLE PIXEL TYPES

  AVERAGE, long option: --method=average , short option: -pa
     Produces a single image. Each pixel
     is the average of all frames addressing that pixel.
  TINYAVERAGE, long option: --method=tinyaverage , short option: -pA
     A less accurate but more space-efficient version of &quot;average&quot;.
  LAST, long option: --method=last , short option: -pl
     Produces a single image. Each pixel
     records the latest color addressing that pixel.
  FIRST, long option: --method=first , short option: -pf
     Produces a single image. Each pixel
     records whatever first appeared in that spot.
  MOSTUSED, long option: --method=mostused, short option: -pm
     Produces a single image. Each pixel
     records the color that most often occured in that location.
     Use this option for making maps!
  LEASTUSED, long option: --method=leastused, short option: -pe
     Produces a single image. Each pixel
     records the color that least commonly occured in that location.
  LASTNMOST, long option: --method=lastnmost, short option: -pL
     Combines &quot;mostused&quot; and &quot;last&quot;. Set threshold using
     the -f option. Example: -f16 -pL = most used of last 16 pixels.
     If -f0, then selects the last not-common pixel value.
     If -f value is negative, uses leastused instead of mostused.
  FIRSTNMOST, long option: --method=firstnmost, short option: -pF
     Combines &quot;mostused&quot; and &quot;first&quot;. Set threshold using
     the -f option. Example: -f16 -pF = most used of first 16 pixels.
     If -f0, then selects the first not-common pixel value.
     If -f value is negative, uses leastused instead of mostused.
  ACTIONAVG, long option: --method=actionavg, short option: -pt
     Similar to average, except that blurring of actors
     over the background is avoided.
  CHANGELOG, long option: --method=changelog, short option: -pc
     Produces an animation. Also supports motion blur.
  LOOPINGLOG, long option: --methods=loopinglog, short option: -po
     Produces a time-restricted animation.
     Also called, &quot;lemmings mode&quot;.
     Use the -l option to set loop length in frames. Supports motion blur.
  LOOPINGAVG, long option: --methods=loopingavg, short option: -pv
     A combination of loopinglog and actionavg, also supports motion blur.

DEFINING MASKS

  You can use masks to block out HUD / splitscreens
  so that it will not intervene with the animation.
  To define mask, use the --mask option, or -m for short.
  Mask syntax: x1,y1,width,height,colors
  Examples:
    -m0,0,256,32
       Mask out a 256x32 wide section at the top of screen
    -m0,0,256,32,FFFFFF
       From the 256x32 wide section at the top of screen,
       mask out those pixels whose color is white (#FFFFFF)
    -m16,16,8,40,000000,483D8B
       From the 8x40 wide section at coordinates 16x16,
       mask out those pixels whose color is either
       black (#000000) or dark slate blue (#483D8B)

TIPS

Converting a GIF animation into individual frame files:
   gifsicle -U -E animation.gif
   animmerger &lt;...&gt; animation.gif.*

To create images with multiple methods in succession,
you can use the multimode option. For example,
    --method average,last,mostused, or -pa,l,m
creates three images, corresponding to that if
you ran animmerger with -pa, -pl, -pm options
in succession. Note that all modes share the same
other parameters (firstlast, looplength).
The benefit in doing this is that the image alignment
phase needs only be done once.

Different combinations of pixel methods require different
amounts of memory. Use the -v option to see how much memory
is required per pixel when using different options.
animmerger always strives to choose the smallest pixel
implementation that provides all of the requested features.

When creating animations of video game content, please take
all necessary steps to ensure that background stays immobile
while characters move. Parallax animation is bad; If possible,
please fix all background layers so that they scroll at even
rate.

</pre>

</div><H2 id="h1" class="level2"><a name="h1"></a>5. Copying</H2><div class="level2" id="divh1">

animmerger has been written by Joel Yliluoma, a.k.a.
<a href="http://iki.fi/bisqwit/">Bisqwit</a>,<br>
and is distributed under the terms of the
<a href="http://www.gnu.org/licenses/licenses.html#GPL">General Public License</a> (GPL).

</div><H2 id="h2" class="level2"><a name="h2"></a>6. Requirements</H2><div class="level2" id="divh2">

GNU make and C++ compiler is required to recompile the source code.<br>
libgd is also required.

</div><H2 id="h3" class="level2"><a name="h3"></a>7. See also</H2><div class="level2" id="divh3">

<ul>
<li><a href="http://advsys.net/ken/utils.htm">pngout</a> for making PNG files considerably smaller.
</li>
<li><a href="http://www.lcdf.org/gifsicle/">gifsicle</a> for creating and optimizing GIF animations
</li>
</ul>

</div><H2 id="download" class="level2"><a name="download"></a>8. Downloading</H2><div class="level2" id="divdownload">
   The official home page of animmerger
   is at <a href="http://iki.fi/bisqwit/source/animmerger.html">http://iki.fi/bisqwit/source/animmerger.html</a>.<br>
   Check there for new versions.
<p>Additionally, the most recent source code (bleeding edge) for animmerger can also be downloaded by cloning the Git repository by:<ul style="margin-left:3em;margin-top:0px"><li><code> git clone <a href="git://bisqwit.iki.fi/animmerger.git">git://bisqwit.iki.fi/animmerger.git</a></code></li><li><code> git checkout origin/release -b release</code></li><li><code> git checkout origin/master  -b master</code></li></ul></p></div> <p align=right><small>Generated from
       <tt>progdesc.php</tt> (last updated: Wed, 18 Aug 2010 01:09:14 +0300)<br>
  with <tt>docmaker.php</tt> (last updated: Wed, 18 Aug 2010 01:09:13 +0300)<br>
  at Wed, 18 Aug 2010 01:09:14 +0300</small>
 </p>
</body>
</html>
