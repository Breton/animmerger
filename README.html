<html><head><meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
 <title>Animation merger</title>
 <style type="text/css"><!--
TABLE.toc {border:0px}
A:link,A:visited{text-decoration:none;color:#2A3B83}
A:hover{text-decoration:underline;color:#002040}
A:active{text-decoration:underline;color:#004060;background:#CCD8FF}
TD.toc   {font-size:80%; font-family:Tahoma; text-align:left}
H1       {font-size:250%; font-weight:bold} .level1 {text-align:center}
H2       {font-size:200%; font-weight:bold} .level2 {margin-left:1%}
H3       {font-size:160%; font-weight:bold} .level3 {margin-left:2%}
H4       {font-size:145%; font-weight:bold} .level4 {margin-left:3%}
H5       {font-size:130%; font-weight:bold} .level5 {margin-left:4%}
H6       {font-size:110%; font-weight:bold} .level5 {margin-left:5%}
BODY{background:white;color:black}
CODE{font-family:lucida console,courier new,courier;color:#105000}
PRE.smallerpre{font-family:lucida console,courier new,courier;font-size:80%;color:#500010;margin-left:30px}
SMALL    {font-size:70%}
.nonmail { visibility:hidden;position:absolute; top:0px;left:0px }
.ismail  { font-weight:normal }
--></style></head>
 <body>
  <h1>Animation merger</h1>
  <h2 class=level2> 0. Contents </h2>
  
  This is the documentation of animmerger-1.2.0.1.
<div class=toc><table cellspacing=0 cellpadding=0 class=toc><tr><td width="50%" valign=middle align=left nowrap class=toc>&nbsp;&nbsp;&nbsp;1. <a href="#h0">Purpose</a><br>&nbsp;&nbsp;&nbsp;2. <a href="#methods">Pixel methods</a><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2.1. <a href="#static">Static methods</a><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2.1.1. <a href="#average">AVERAGE</a><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2.1.2. <a href="#mostused">MOSTUSED</a><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2.1.3. <a href="#last">LAST</a><br></td>
<td width="50%" valign=middle align=left nowrap class=toc>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2.2. <a href="#animated">Animated methods</a><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2.2.1. <a href="#changelog">CHANGELOG</a><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2.2.2. <a href="#loopinglog">LOOPINGLOG</a><br>&nbsp;&nbsp;&nbsp;3. <a href="#usage">Usage</a><br>&nbsp;&nbsp;&nbsp;4. <a href="#h1">Copying</a><br>&nbsp;&nbsp;&nbsp;5. <a href="#h2">Requirements</a><br>&nbsp;&nbsp;&nbsp;6. <a href="#download">Downloading</a><br></td>
</tr></table></div><H2 id="h0" class="level2"><a name="h0"></a>1. Purpose</H2><div class="level2" id="divh0">

Animmerger converts a 2D animation from local-frame-of-reference
into global-frame-of-reference. That is, for a movie that follows
an actor around (and the background scrolls to follow them), it
creates a movie that has a fixed background, and the camera moves
around in the scene.
<p>
It does this with a motion detection algorithm, and a set of
different pixel methods.

</div><H2 id="methods" class="level2"><a name="methods"></a>2. Pixel methods</H2><div class="level2" id="divmethods">

<table>
<tr><td valign=top>
<img src="http://bisqwit.iki.fi/jutut/kuvat/animmerger/original.gif"
     alt="Original animation">
</td><td valign=top>
As a sample, here is the original animation (712100 bytes).
<p>
The animation was created literally by taking a screenshot
from the NES emulator every frame.<br>
(I hacked the emulator
to automatically produce a screenshot after every frame.)
<p>
What follows below, is a list of the pixel methods supported
by animmerger,<br>
along with example images demonstrating what
that pixel method does.
<p>
The <code>-m0,8,256,16,020202,A64010,D09030,006E84,511800,FFFFFF</code><br>
parameter was given to animmerger to remove the HUD that is 256x16 wide<br>
and begins at 0,8. The hexadecimal numbers listed are these colors:
<table border=1>
 <tr>
  <td style="width:32px;height:32px;background:#020202;color:#FFF">020202</td>
  <td style="width:32px;height:32px;background:#A64010;color:#000">A64010</td>
  <td style="width:32px;height:32px;background:#D09030;color:#000">D09030</td>
  <td style="width:32px;height:32px;background:#006E84;color:#FFF">006E84</td>
  <td style="width:32px;height:32px;background:#511800;color:#FFF">511800</td>
  <td style="width:32px;height:32px;background:#FFFFFF;color:#000">FFFFFF</td>
 </tr>
</table>
This removes the text (white) as well as the blinking coin.
</td></tr></table><br>
<small>
The graphics material comes from Super Mario Bros.<br>
Mario, Super Mario Bros, and The Nintendo Entertainment System (NES)
are registered trademarks of Nintendo of America Inc.
But you knew that, right?</small>

</div><H3 id="static" class="level3"><a name="static"></a>2.1. Static methods</H3><div class="level3" id="divstatic">

</div><H4 id="average" class="level4"><a name="average"></a>2.1.1. AVERAGE</H4><div class="level4" id="divaverage">

The "average" method produces a "motion blur" effect of the entire
input, reducing it into a single frame.
<p>
<img src="http://bisqwit.iki.fi/jutut/kuvat/animmerger/method-a.png"
     alt="Average">
<p>
You can see a faint trace of all animated actors that appeared in
the animation. Mario moved very fast so his trace is quite difficult
to spot.
<p>
Produced with commandline:<br>
<code># animmerger -pa snaps/*.png -m0,8,256,16,020202,A64010,D09030,006E84,511800,FFFFFF<br>
# mv tile-0000.png demo/method-a.png<br>
# <a href="http://advsys.net/ken/utils.htm">pngout</a>-hard demo/method-a.png</code>

</div><H4 id="mostused" class="level4"><a name="mostused"></a>2.1.2. MOSTUSED</H4><div class="level4" id="divmostused">

The "most used" method produces what might be the background
image for the entire animation.
<p>
<img src="http://bisqwit.iki.fi/jutut/kuvat/animmerger/method-m.png"
     alt="Most used">
<p>
Note: If there is an actor that sits in a certain location
for a long time, it is also recorded.<br>
In this example, there were none though.<br>
This mode does not thus remove all actors, but it does remove
anything that wanders around.
<p>
Produced with commandline:<br>
<code># animmerger -pm snaps/*.png -m0,8,256,16,020202,A64010,D09030,006E84,511800,FFFFFF<br>
# mv tile-0000.png demo/method-m.png<br>
# pngout-hard demo/method-m.png</code>

</div><H4 id="last" class="level4"><a name="last"></a>2.1.3. LAST</H4><div class="level4" id="divlast">

The "last" method is a simpler implementation of the "most used"
method, simply recording the last pixel value in any location.
<p>
<img src="http://bisqwit.iki.fi/jutut/kuvat/animmerger/method-l.png"
     alt="Last">
<p>
Produced with commandline:<br>
<code># animmerger -pl snaps/*.png -m0,8,256,16,020202,A64010,D09030,006E84,511800,FFFFFF<br>
# mv tile-0000.png demo/method-l.png<br>
# pngout-hard demo/method-l.png</code>

</div><H3 id="animated" class="level3"><a name="animated"></a>2.2. Animated methods</H3><div class="level3" id="divanimated">

</div><H4 id="changelog" class="level4"><a name="changelog"></a>2.2.1. CHANGELOG</H4><div class="level4" id="divchangelog">

The "changelog" method records the entire animation (121995 bytes in this example).<br>
It takes considerably less disk space (and is faster to load) than the original animation, because now the background does not scroll.
<p>
<img src="http://bisqwit.iki.fi/jutut/kuvat/animmerger/method-c.gif"
     alt="Changelog">
<p>
You see some artifacts in the turtle and in Mario when they appear
near the top of the screen. This is because they were behind the
HUD (the text "WORLD 8-2" for instance), which was removed.<br>
In the case of the turtle, the turtle's white pixels were also
removed, because the HUD removal was based on color as well
as coordinates.<br>
Horizontal disappearance of the actors is because of the viewport
scrolling past them. They do not exist outside those parameters
in the original animation either.
<p>
Here is how the animation looks like, if the HUD is not removed. (246643 bytes)
<p>
<img src="http://bisqwit.iki.fi/jutut/kuvat/animmerger/method-tc.gif"
     alt="Changelog, with HUD intact">
<p>
Exteriors, i.e. content outside the "current" viewport of the animation
are colored as in the "most used" pixel method.<br>
This is evident in the trails left by the HUD as it scrolls by at different speeds.
<p>
Produced with commandline:<br>
<code>
# rm tile-*.png tile-*.gif<br>
# animmerger -pc snaps/*.png -m0,8,256,16,020202,A64010,D09030,006E84,511800,FFFFFF<br>
# <a href="http://www.imagemagick.org/">mogrify</a> -format gif tile-*.png<br>
# <a href="http://www.lcdf.org/gifsicle/">gifsicle</a> -O2 -o demo/method-c.gif -l0 -d3 tile-*.gif</code><br>
The version with HUD intact was created with the same commandline,
except with the -m option removed.

</div><H4 id="loopinglog" class="level4"><a name="loopinglog"></a>2.2.2. LOOPINGLOG</H4><div class="level4" id="divloopinglog">

The "loopinglog" method records the entire animation,
but reuses existing frames. Use the <code>-l</code> option
to set the loop length in frames.<br>
The smaller value you use, the shorter the animation
is in the number of frames, but the more pronounced
is the "lemmings" effect.
<p>
30 frames (99755 bytes):<br>
<img src="http://bisqwit.iki.fi/jutut/kuvat/animmerger/method-ol30.gif"
     alt="Loop, 30 frames">
<p>
10 frames (73850 bytes):<br>
<img src="http://bisqwit.iki.fi/jutut/kuvat/animmerger/method-ol10.gif"
     alt="Loop, 10 frames">
<p>
4 frames (49890 bytes):<br>
<img src="http://bisqwit.iki.fi/jutut/kuvat/animmerger/method-ol4.gif"
     alt="Loop, 4 frames">
<p>
Produced with commandline:<br>
<code>
# for l in 4 10 30; do <br>
# &nbsp; rm tile-*.png tile-*.gif<br>
# &nbsp; animmerger -l$l -po snaps/*.png -m0,8,256,16,020202,A64010,D09030,006E84,511800,FFFFFF<br>
# &nbsp; mogrify -format gif tile-*.png<br>
# &nbsp; gifsicle -O2 -o demo/method-ol"$l".gif -l0 -d3 tile-*.gif<br>
# done</code>

</div><H2 id="usage" class="level2"><a name="usage"></a>3. Usage</H2><div class="level2" id="divusage">

<pre class=smallerpre>animmerger v1.2.0 - Copyright (C) 2010 Joel Yliluoma (http://iki.fi/bisqwit/)

Usage: animmerger [&lt;options&gt;] &lt;imagefile&gt; [&lt;...&gt;]

Merges animation frames together with motion shifting.

 --help, -h             This help
 --mask, -m &lt;defs&gt;      Define a mask, see instructions below
 --method, -p &lt;mode&gt;    Select pixel type, see below
 --bgmethod, -b &lt;mode&gt;  Select pixel type for alignment tests
                        Tip: Use -bl for some memory usage reduction
 --looplength, -l &lt;int&gt; Set loop length for the LOOPINGLOG mode
 --version, -V          Displays version information
 --refscale, -r &lt;x&gt;,&lt;y&gt; Change the grid size that controls
     how many samples are taken from the background image
     for comparing with the input image, for image alignment.
     Smaller grid = more accurate but slower aligning.
     Default: -r32,32
     Set to e.g. -r8,8 if you experience misalignment problems.
 --mvrange, -a &lt;xmin&gt;,&lt;ymin&gt;,&lt;xmax&gt;,&lt;ymax&gt;
     Change the limits of motion vectors.
     Default: -9999,-9999,9999,9999
     Example: --mvrange -4,0,4,0 specifies that the screen may
     only scroll horizontally and by 4 pixels at most per frame.
 --gif, -g              Save GIF frames instead of PNG frames

animmerger will always output PNG files into the current
working directory, with the filename pattern tile-####.png
where #### is a sequential number beginning from 0000.

AVAILABLE PIXEL TYPES

  AVERAGE, long option: --method=average , short option: -pa
     Produces a single image. Each pixel
     is the average of all frames addressing that pixel.
  LAST, long option: --method=long , short option: -pl
     Produces a single image. Each pixel
     records the latest color addressing that pixel.
  MOSTUSED, long option: --method=mostused, short option: -pm
     Produces a single image. Each pixel
     records the color that most often occured in that location.
     Use this option for making maps!
  CHANGELOG, long option: --method=changelog, short option: -pc
     Produces an animation.
  LOOPINGLOG, long option: --methods=loopinglog, short option: -po
     Produces a time-restricted animation.
     Also called, &quot;lemmings mode&quot;.
     Use the -l option to set loop length in frames.

DEFINING MASKS

  You can use masks to block out HUD / splitscreens
  so that it will not intervene with the animation.
  To define mask, use the --mask option, or -m for short.
  Mask syntax: x1,y1,width,height,colors
  Examples:
    -m0,0,256,32
       Mask out a 256x32 wide section at the top of screen
    -m0,0,256,32,FFFFFF
       From the 256x32 wide section at the top of screen,
       mask out those pixels whose color is white (#FFFFFF)
    -m16,16,8,40,000000,483D8B
       From the 8x40 wide section at coordinates 16x16,
       mask out those pixels whose color is either
       black (#000000) or dark slate blue (#483D8B)

TIPS

Converting tile-*.png into a GIF animation:
   mogrify -format gif tile-????.png
   gifsicle -O2 -o animation.gif -l0 -d3 tile-????.gif

Converting a GIF animation into individual frame files:
   gifsicle -U -E animation.gif
   animmerger &lt;...&gt; animation.gif.*

</pre>

</div><H2 id="h1" class="level2"><a name="h1"></a>4. Copying</H2><div class="level2" id="divh1">

animmerger has been written by Joel Yliluoma, a.k.a.
<a href="http://iki.fi/bisqwit/">Bisqwit</a>,<br>
and is distributed under the terms of the
<a href="http://www.gnu.org/licenses/licenses.html#GPL">General Public License</a> (GPL).

</div><H2 id="h2" class="level2"><a name="h2"></a>5. Requirements</H2><div class="level2" id="divh2">

GNU make and C++ compiler is required to recompile the source code.<br>
libgd is also required.

</div><H2 id="download" class="level2"><a name="download"></a>6. Downloading</H2><div class="level2" id="divdownload">
   The official home page of animmerger
   is at <a href="http://iki.fi/bisqwit/source/animmerger.html">http://iki.fi/bisqwit/source/animmerger.html</a>.<br>
   Check there for new versions.
<p>Additionally, the most recent source code (bleeding edge) for animmerger can also be downloaded by cloning the Git repository by:<ul style="margin-left:3em;margin-top:0px"><li><code> git clone <a href="git://bisqwit.iki.fi/animmerger.git">git://bisqwit.iki.fi/animmerger.git</a></code></li><li><code> git checkout origin/release -b release</code></li><li><code> git checkout origin/master  -b master</code></li></ul></p></div> <p align=right><small>Generated from
       <tt>progdesc.php</tt> (last updated: Thu, 05 Aug 2010 12:04:36 +0300)<br>
  with <tt>docmaker.php</tt> (last updated: Thu, 05 Aug 2010 12:04:36 +0300)<br>
  at Thu, 05 Aug 2010 12:04:36 +0300</small>
 </p>
</body>
</html>
